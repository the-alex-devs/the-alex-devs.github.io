<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Initial configuration of an Azure ExpressRoute Private Peering"><title>Azure ExpressRoute Initial Setup</title><link rel=canonical href=https://alexdean.link/p/expressroute-initial-setup/><link rel=stylesheet href=/scss/style.min.ab7cb56a3d79cae5a6bbe039121d532d103f0b8ab99a20c854c3ee59fe459449.css><meta property='og:title' content="Azure ExpressRoute Initial Setup"><meta property='og:description' content="Initial configuration of an Azure ExpressRoute Private Peering"><meta property='og:url' content='https://alexdean.link/p/expressroute-initial-setup/'><meta property='og:site_name' content="Alex's IT Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Azure'><meta property='article:tag' content='ExpressRoute'><meta property='article:tag' content='Routing'><meta property='article:tag' content='BGP'><meta property='article:published_time' content='2025-10-20T00:00:00+00:00'><meta property='article:modified_time' content='2025-10-20T00:00:00+00:00'><meta property='og:image' content='https://alexdean.link/p/expressroute-initial-setup/expressrouteIcon.png'><meta name=twitter:title content="Azure ExpressRoute Initial Setup"><meta name=twitter:description content="Initial configuration of an Azure ExpressRoute Private Peering"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://alexdean.link/p/expressroute-initial-setup/expressrouteIcon.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/me_hu_8c1c0da1e98e9eae.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Alex's IT Blog</a></h1><h2 class=site-description>Welcome to my blog! I'll write about any things I learned, issues, events, or news that I find interesting in the world of IT networking/security.</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/expressroute-initial-setup/><img src=/p/expressroute-initial-setup/expressrouteIcon_hu_6c5dc54001894318.png srcset="/p/expressroute-initial-setup/expressrouteIcon_hu_6c5dc54001894318.png 800w, /p/expressroute-initial-setup/expressrouteIcon_hu_d91cdc1d0a297cb0.png 1600w" width=800 height=420 loading=lazy alt="Featured image of post Azure ExpressRoute Initial Setup"></a></div><div class=article-details><header class=article-category><a href=/categories/networking/>Networking</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/expressroute-initial-setup/>Azure ExpressRoute Initial Setup</a></h2><h3 class=article-subtitle>Initial configuration of an Azure ExpressRoute Private Peering</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 20, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>3 minute read</time></div></footer></div></header><section class=article-content><p>Finding good documentation on the configurations needed for the CE side of an ExpressRoute setup is difficult. I recently went through an initial setup and ran into several obstacles. <b>This post will focus on the CE config.</b></p><p>First, you need an ExpressRoute circuit established. This is done through a Microsoft partner. I&rsquo;m assuming you&rsquo;re already done with this step and are ready to actually begin configuring things.</p><p>Next, you&rsquo;ll need to decide on two /30 networks to assign for the BGP peerings with Microsoft. Keep in mind, these two /30s must NOT overlap with anything you end up building in Azure. For example, if you choose 10.0.0.0/30 and 10.0.0.4/30, you CANNOT use 10.0.0.0/24 within a vnet later (exception: if the vnet containing the overlapping subnet is not and never will be peered to the vnet with the circuit within it. I&rsquo;d just avoid overlapping altogether).</p><p>Once that&rsquo;s decided, configure them within Azure. It&rsquo;s very straightforward and there&rsquo;s plenty of documentation out there on this part. <a href=https://learn.microsoft.com/en-us/azure/expressroute/expressroute-howto-routing-portal-resource-manager target=_blank>See here for Azure-side private peering configuration.</a></p><p>On the customer equipment (CE) side, you&rsquo;re going to be configuring the BGP peer on your edge device. In the example below, it&rsquo;ll be configs for a Cisco ASR router.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>### Azure ExpressRoute CE Router BGP configuration ###
</span></span><span class=line><span class=cl>!
</span></span><span class=line><span class=cl>ip prefix-list AZURE_PREFIX_FILTER seq 10 permit 192.168.1.0/24
</span></span><span class=line><span class=cl>ip prefix-list AZURE_PREFIX_FILTER seq 20 permit 192.168.2.0/24
</span></span><span class=line><span class=cl>!
</span></span><span class=line><span class=cl>router bgp 64512
</span></span><span class=line><span class=cl>bgp log-neighbor-changes
</span></span><span class=line><span class=cl>neighbor 10.0.0.2 remote-as 12076
</span></span><span class=line><span class=cl>neighbor 10.0.0.2 ebgp-multihop 255
</span></span><span class=line><span class=cl>neighbor 10.0.0.6 remote-as 12076
</span></span><span class=line><span class=cl>neighbor 10.0.0.6 ebgp-multihop 255
</span></span><span class=line><span class=cl>!
</span></span><span class=line><span class=cl>address-family ipv4
</span></span><span class=line><span class=cl>  network 192.168.1.0/24
</span></span><span class=line><span class=cl>  network 192.168.2.0/24
</span></span><span class=line><span class=cl>  neighbor 10.0.0.2 activate
</span></span><span class=line><span class=cl>  neighbor 10.0.0.2 prefix-list AZURE_PREFIX_FILTER out
</span></span><span class=line><span class=cl>  neighbor 10.0.0.6 activate
</span></span><span class=line><span class=cl>  neighbor 10.0.0.6 prefix-list AZURE_PREFIX_FILTER out
</span></span><span class=line><span class=cl>exit-address-family
</span></span><span class=line><span class=cl>!
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0.5
</span></span><span class=line><span class=cl>description ExpressRoute Connection
</span></span><span class=line><span class=cl>encapsulation dot1Q 5
</span></span><span class=line><span class=cl>ip address 10.0.0.5 255.255.255.252 secondary
</span></span><span class=line><span class=cl>ip address 10.0.0.1 255.255.255.252
</span></span><span class=line><span class=cl>End
</span></span></code></pre></td></tr></table></div></div><p>A few key takeaways from this template:</p><ul><li>Make sure you include an outbound prefix list. If you are advertising too many prefixes to Azure, it will not form neighborships properly.</li><li>Microsoft&rsquo;s ASN will always be 12076 for private peering.</li><li>Your IP in the two /30 subnets will always be the first usable IP in the subnet. The second usable IPs need to be configured on the Azure side.</li><li>the &ldquo;ebgp-multihop&rdquo; statement must be configured as your Azure neighbor will not be directly connected.</li><li>If you&rsquo;re having trouble with the peering, you can verify your route and ARP tables on both your edge device and on the Azure side. Work on getting pings working from your subinterface IPs to your Azure peer IPs and work your way back.</li><li>It&rsquo;s not shown in the template above, but be sure to add ACLs to your subinterface.</li></ul><p>Importantly: READ THE BGP DEBUG LOGS. If you see SAFI/AFI errors, you&rsquo;ll need to make sure your address-family configs are correct and compatible with the peer. Keep most BGP settings default as there is not much documentation regarding specific Azure peer BGP settings. If you see logs saying the peer has reached its prefix limit, verify your outbound prefix lists are correct and filtering only what you want to advertise.</p><p>Useful BGP troubleshooting commands:</p><ul><li>Show ip bgp summary &ndash; shows BGP neighbors and if they&rsquo;re exchanging routes</li><li>Show ip bgp neighbor 10.0.0.2 &ndash; shows detailed info about a BGP neighbor</li><li>Debug ip bgp &ndash; can specify a neighbor to debug so you don&rsquo;t get irrelevant logs</li><li>Term mon &ndash; to view BGP debug logs</li></ul><p>Don&rsquo;t forget: your cloud IP space will need added to ENS software, firewall rules, router ACLs, and any other points in your infrastructure that may be filtering traffic!</p><p>Useful Links:</p><ul><li><a href=https://learn.microsoft.com/en-us/azure/expressroute/ target=_blank>ExpressRoute Documentation</a></li><li><a href=https://learn.microsoft.com/en-us/azure/expressroute/expressroute-config-samples-routing target=_blank>ExpressRoute Router Configuration Sample</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/azure/>Azure</a>
<a href=/tags/expressroute/>ExpressRoute</a>
<a href=/tags/routing/>Routing</a>
<a href=/tags/bgp/>BGP</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Oct 20, 2025 00:00 UTC</span></section></footer></article><div id=cusdis_thread data-host=https://cusdis.com data-app-id=e191f013-8e7d-45b1-b264-aae8cebc46f4 data-page-id=46ae20456d145293fe72df238d04343d data-page-url=https://alexdean.link/p/expressroute-initial-setup/ data-page-title="Azure ExpressRoute Initial Setup"></div><script async defer src=https://cusdis.com/js/cusdis.es.js></script><script>function setCusdisTheme(e){let t=document.querySelector("#cusdis_thread iframe");t&&window.CUSDIS.setTheme(e)}window.addEventListener("onColorSchemeChange",e=>{setCusdisTheme(e.detail)})</script><script>function resizeIframesToContent(){const e=document.querySelectorAll("iframe");e.forEach(e=>{try{const t=e.contentDocument||e.contentWindow.document;if(e.onload=function(){try{const t=e.contentWindow.document.body.scrollHeight;e.style.height=t+"px"}catch(e){console.warn("Could not access iframe contents (possibly cross-origin):",e)}},t&&t.readyState==="complete"){const n=t.body.scrollHeight;e.style.height=n+"px"}}catch(e){console.warn("Iframe resizing failed due to cross-origin restrictions:",e)}})}window.addEventListener("load",resizeIframesToContent)</script><script>const observer=new MutationObserver(e=>{e.forEach(e=>{if(e.addedNodes.length==0)return;const t=e.addedNodes[0];if(t.tagName!=="IFRAME")return;const n=`
.dark {
background: rgb(48, 48, 48);
}
`;t.srcdoc=t.srcdoc.replace("</style>",n+"</style>")})});observer.observe(document.getElementById("cusdis_thread"),{childList:!0,subtree:!0})</script><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>